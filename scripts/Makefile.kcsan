# SPDX-License-Identifier: GPL-2.0
ifdef CONFIG_KCSAN

# GCC and Clang accept backend options differently. Do not wrap in cc-option,
# because Clang accepts "--param" even if it is unused.
ifdef CONFIG_CC_IS_CLANG
cc-param = -mllvm -$(1)
else
cc-param = --param -$(1)
endif

CFLAGS_KCSAN := -fsanitize=thread \
	$(call cc-option,$(call cc-param,tsan-instrument-func-entry-exit=0) -fno-optimize-sibling-calls)

endif # CONFIG_KCSAN
